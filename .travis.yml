language: node_js

cache:
  directories:
    - ~/.npm

notifications:
  email: false

node_js:
  - '8'
  - '10'
  - '12'

script: npm run test:prod

jobs:
  include:
    - stage: lint
      node_js: '12'
      script: npm run lint
    - stage: deploy docs
      node_js: '12'
      script: npm run build
      deploy:
        provider: pages
        skip_cleanup: true # Don't clean up files generated by "npm run build"
        github_token: $GH_TOKEN
        keep_history: true
        verbose: true
      if: branch = master
    - stage: release to NPM
      node_js: '12'
      script:
        - npm run build
        - npm run semantic-release
      if: branch = master

branches:
  except:
    - /^v\d+\.\d+\.\d+$/
